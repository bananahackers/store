"use strict";const toastAnimateOptions={in:"bounceInDown",out:"bounceOutUp"};var currentSelectedCategory="all",StoreDbAPI=new StoreDatabaseAPI;function generateReadableCategories(e){var t="";const a=e.length;for(const n in e){const o=e[n],s=StoreDbAPI.db.categories[o].name;t+=n+1<a?s?s+", ":o+", ":s?s+" ":o}return t}function listAppsByCategory(e,t){return StoreDbAPI.sortApps(StoreDbAPI.getAppsByCategory(e),t)}function addAppCard(e){appsListElement.appendChild(document.createElement("br"));var t=document.createElement("div");t.classList.add("card"),t.id=e.slug,appsListElement.appendChild(t);var a=document.createElement("div");a.classList.add("card-content"),t.appendChild(a);var n=document.createElement("div");n.classList.add("media"),a.appendChild(n);var o=document.createElement("div");o.classList.add("media-left"),n.appendChild(o);var s=document.createElement("figure");s.classList.add("image","is-48x48","is-unselectable");var i=document.createElement("img");i.src=e.icon,s.appendChild(i),o.appendChild(s);var d=document.createElement("div");d.classList.add("media-content"),n.appendChild(d);var l=document.createElement("p");l.classList.add("title","is-4"),l.innerText=e.name,d.appendChild(l);var c=document.createElement("p");c.classList.add("subtitle","is-6"),c.innerText=generateReadableCategories(e.meta.categories),d.appendChild(c);var r=document.createElement("div");r.classList.add("content"),r.innerText=e.description,a.appendChild(r);var p=document.createElement("footer");p.classList.add("card-footer"),t.appendChild(p);var m=document.createElement("a");m.classList.add("card-footer-item","is-unselectable","app"),m.setAttribute("data-app-categories",e.meta.categories.toString()),m.setAttribute("data-app-name",e.name),m.innerText="View app details",p.appendChild(m);var u=document.createElement("a");u.classList.add("card-footer-item","is-unselectable","share"),u.href="#"+e.slug,u.innerText="Copy link to app",p.appendChild(u)}document.getElementById("scrolltop-fab").onclick=function(){window.scrollTo({top:0,behavior:"smooth"})};var reloadButton=document.getElementById("reload-button"),sortSelect=document.getElementById("sort-select");sortSelect.onchange=function(e){reloadButton.classList.add("is-loading");var t=document.getElementById("sort-icon");switch(t.classList.remove("fa-sort-alpha-down","fa-fire-alt","fa-tags"),e.target.value){case"alphabetical":t.classList.add("fa-sort-alpha-down");break;case"popularity":t.classList.add("fa-fire-alt");break;case"categorical":t.classList.add("fa-tags")}sortSelect.disabled=!0,reloadButton.disabled=!0,appsListElement.innerHTML="",listAppsByCategory(currentSelectedCategory,e.target.value).then((function(e){for(const t in e)addAppCard(e[t]);reloadButton.classList.remove("is-loading"),sortSelect.disabled=!1,reloadButton.disabled=!1,bulmaToast.toast({message:"Apps sorted successfully!",type:"is-success",position:"top-center",closeOnClick:!0,pauseOnHover:!0,animate:toastAnimateOptions})})).catch((function(e){reloadButton.classList.remove("is-loading"),sortSelect.disabled=!1,reloadButton.disabled=!1,bulmaToast.toast({message:"Apps could not be sorted! Check the console for more info.",type:"is-danger",position:"top-center",closeOnClick:!0,pauseOnHover:!0,animate:toastAnimateOptions}),console.log(e)}))};var categoriesTabsElement=document.getElementById("categories-tabs");categoriesTabsElement.onclick=function(e){const t=e.target.classList;if((t.contains("category-link")||t.contains("category-tab"))&&(currentSelectedCategory=e.target.getAttribute("data-category-id"))in StoreDbAPI.db.categories){for(const e of document.querySelectorAll(".category-tab"))e.getAttribute("data-category-id")===currentSelectedCategory?e.classList.add("is-active"):e.classList.remove("is-active");sortSelect.dispatchEvent(new Event("change"))}};var appDetailsModal={controller:new BulmaModal("#app-details-modal"),content:{name:document.getElementById("app-details-modal-app-name"),icon:document.getElementById("app-details-modal-app-icon"),screenshots:{container:document.getElementById("app-details-modal-app-screenshots-container"),columns:document.getElementById("app-details-modal-app-screenshots")},description:document.getElementById("app-details-modal-app-description"),categories:document.getElementById("app-details-modal-app-categories"),maintainer:document.getElementById("app-details-modal-app-maintainer"),version:document.getElementById("app-details-modal-app-version"),type:document.getElementById("app-details-modal-app-type"),has_ads:document.getElementById("app-details-modal-app-has_ads"),has_tracking:document.getElementById("app-details-modal-app-has_tracking"),license:document.getElementById("app-details-modal-app-license"),downloadCount:document.getElementById("app-details-modal-app-downloadCount")},buttons:{download:document.getElementById("app-details-modal-download-button"),donation:document.getElementById("app-details-modal-donation-button")}};appDetailsModal.controller.addEventListener("modal:show",(function(){document.getElementsByTagName("html")[0].classList.add("is-clipped")})),appDetailsModal.controller.addEventListener("modal:close",(function(){document.getElementsByTagName("html")[0].classList.remove("is-clipped")})),appDetailsModal.buttons.download.onclick=function(e){appDownloadsModal.controller.show()},appDetailsModal.buttons.donation.onclick=function(e){window.open(e.target.getAttribute("data-app-donate"),"_blank")};var appDownloadsModal={controller:new BulmaModal("#app-download-modal"),content:{name:document.getElementById("app-download-modal-app-name"),icon:document.getElementById("app-download-modal-app-icon"),qrcode:document.getElementById("app-download-modal-app-download-qrcode")},buttons:{download:document.getElementById("app-download-modal-download-button")}};appDownloadsModal.buttons.download.onclick=function(e){e.target.classList.add("is-loading"),e.target.disabled=!0,StoreDbAPI.dlCountApp(e.target.getAttribute("data-app-slug")).then((function(){e.target.disabled=!1,e.target.classList.remove("is-loading"),window.open(e.target.getAttribute("data-app-download"),"_blank")})).catch((function(){e.target.disabled=!1,e.target.classList.remove("is-loading"),bulmaToast.toast({message:"Failed to record download count! Check the console for more info.",type:"is-danger",position:"top-center",closeOnClick:!0,closeOnHover:!0,animate:toastAnimateOptions})})),window.open(e.target.getAttribute("data-app-download"),"_blank")};var appsListElement=document.getElementById("apps-list");function reloadData(){sortSelect.disabled=!0,reloadButton.disabled=!0,categoriesTabsElement.innerHTML="",StoreDbAPI.loadData().then((function(e){for(const n in e.categories){var t={tab:document.createElement("li"),link:{container:document.createElement("a"),content:{icon:{container:document.createElement("span"),icon:document.createElement("i")},text:document.createElement("span")}}};for(var a of(t.tab.setAttribute("data-category-id",n),t.tab.classList.add("category-tab"),categoriesTabsElement.appendChild(t.tab),t.link.container.setAttribute("data-category-id",n),t.link.container.classList.add("category-link"),t.tab.appendChild(t.link.container),t.link.content.icon.container.setAttribute("data-category-id",n),t.link.content.icon.container.classList.add("icon","is-small","category-link"),t.link.container.appendChild(t.link.content.icon.container),e.categories[n].icon.split(" ")))t.link.content.icon.icon.classList.add(a);t.link.content.icon.icon.classList.add("category-link"),t.link.content.icon.icon.setAttribute("data-category-id",n),t.link.content.icon.container.appendChild(t.link.content.icon.icon),t.link.content.text.innerText=e.categories[n].name,t.link.content.text.setAttribute("data-category-id",n),t.link.content.text.classList.add("category-link"),t.link.container.appendChild(t.link.content.text)}document.querySelector('.category-tab[data-category-id*="all"]').classList.add("is-active"),sortSelect.dispatchEvent(new Event("change"));var n=document.getElementById("data-generated-time-label");e.generatedAt&&(n.innerText=new Date(e.generatedAt),n.classList.remove("is-danger"),n.classList.add("is-success"));var o=document.getElementById("page-loaded-time-label");o.innerText=(new Date).toString(),o.classList.remove("is-danger"),o.classList.add("is-success"),bulmaToast.toast({message:"Data loaded successfully!",type:"is-success",position:"top-center",closeOnClick:!0,pauseOnHover:!0,animate:toastAnimateOptions})})).catch((function(e){bulmaToast.toast({message:"Data could not be loaded! Check the console for more info.",type:"is-danger",position:"top-center",closeOnClick:!0,pauseOnHover:!0,animate:toastAnimateOptions}),console.error(e)}))}appsListElement.onclick=function(e){var t=e.target.classList;if(t.contains("app")){const t=e.target.getAttribute("data-app-categories").split(",")[0];if(t in StoreDbAPI.db.apps.categorical){const s=StoreDbAPI.db.apps.categorical[t][e.target.getAttribute("data-app-name")];if(s){if(s.name?(appDetailsModal.content.name.innerText=s.name,appDownloadsModal.content.name.innerText=s.name):(appDetailsModal.content.name.innerText="Unknown app name",appDownloadsModal.content.name.innerText="Unknown app name"),s.icon?(appDetailsModal.content.icon.src=s.icon,appDownloadsModal.content.icon.src=s.icon):(appDetailsModal.content.icon.src="icons/default-icon.png",appDownloadsModal.content.icon.src="icons/default-icon.png"),s.screenshots)for(var a of(appDetailsModal.content.screenshots.container.style.display="initial",appDetailsModal.content.screenshots.columns.innerHTML="",s.screenshots)){var n=document.createElement("div");n.classList.add("column","is-half"),appDetailsModal.content.screenshots.columns.appendChild(n);var o=document.createElement("img");o.src=a,n.appendChild(o)}else appDetailsModal.content.screenshots.container.style.display="none";s.description?appDetailsModal.content.description.innerText=s.description:appDetailsModal.content.description.innerText="No description.",s.meta.categories?appDetailsModal.content.categories.innerHTML="Categories: <b>"+generateReadableCategories(s.meta.categories)+"</b>":appDetailsModal.content.categories.innerHTML="Categories: <b>unknown</b>",s.author?appDetailsModal.content.maintainer.innerHTML="Author(s): <b>"+s.author+"</b>":s.maintainer?appDetailsModal.content.maintainer.innerHTML="Maintainer(s): <b>"+s.maintainer+"</b>":appDetailsModal.content.maintainer.innerHTML="Authors/maintainers: <b>unknown</b>",s.download.version?appDetailsModal.content.version.innerHTML="Version: <b>"+s.download.version+"</b>":appDetailsModal.content.version.innerHTML="Version: <b>unknown</b>",s.type?appDetailsModal.content.type.innerHTML="Type: <b>"+s.type+"</b>":appDetailsModal.content.type.innerHTML="Type: <b>unknown</b>",void 0!==s.has_ads?appDetailsModal.content.has_ads.innerHTML="Ads: <b>"+s.has_ads+"</b>":appDetailsModal.content.has_ads.innerHTML="Ads: <b>unknown</b>",void 0!==s.has_tracking?appDetailsModal.content.has_tracking.innerHTML="Tracking: <b>"+s.has_tracking+"</b>":appDetailsModal.content.has_tracking.innerHTML="Tracking: <b>unknown</b>",s.license?appDetailsModal.content.license.innerHTML="License: <b>"+s.license+"</b>":appDetailsModal.content.license.innerHTML="License: <b>unknown</b>",StoreDbAPI.db.apps.downloadCounts[s.slug]?appDetailsModal.content.downloadCount.innerHTML="Downloads: <b>"+StoreDbAPI.db.apps.downloadCounts[s.slug]+"</b>":appDetailsModal.content.downloadCount.innerHTML="Downloads: <b>unknown</b>",s.download.url?(appDetailsModal.buttons.download.style.display="initial",appDetailsModal.buttons.download.setAttribute("data-app-download",s.download.url),appDownloadsModal.buttons.download.style.display="initial",appDownloadsModal.buttons.download.setAttribute("data-app-download",s.download.url),appDownloadsModal.buttons.download.setAttribute("data-app-slug",s.slug),appDownloadsModal.content.qrcode.innerHTML="",new QRCode(appDownloadsModal.content.qrcode,"bhackers:"+s.slug)):(appDetailsModal.buttons.download.style.display="none",appDownloadsModal.buttons.download.style.display="none"),s.donation?(appDetailsModal.buttons.donation.style.display="initial",appDetailsModal.buttons.donation.setAttribute("data-app-donate",s.donation)):appDetailsModal.buttons.donation.style.display="none",appDetailsModal.controller.show()}else bulmaToast.toast({message:'App does not exist in category "'+t+'"!',type:"is-danger",position:"top-center",closeOnClick:!0,pauseOnHover:!0,animate:toastAnimateOptions})}else bulmaToast.toast({message:'Given category "'+t+'" does not exist!',type:"is-danger",position:"top-center",closeOnClick:!0,pauseOnHover:!0,animate:toastAnimateOptions})}else if(t.contains("share")){var s=document.getElementById("link-ghost");s.innerText=window.location,s.select(),document.execCommand("copy"),bulmaToast.toast({message:"Copied sharable link to clipboard!",type:"is-success",position:"top-center",closeOnClick:!0,closeOnHover:!0,animate:toastAnimateOptions})}},reloadButton.onclick=function(){reloadData()},reloadData();var githubCommitWorker=new Worker("assets/js/index/workers/githubcommit-worker.js");githubCommitWorker.onmessage=function(e){if(githubCommitWorker.terminate(),null!==e.data){var t=document.getElementById("webstore-github-commit-label");t.innerText=e.data.substring(0,7),t.setAttribute("href","https://github.com/jkelol111/webstore/blob/"+e.data+"/src/"),t.classList.remove("is-danger"),t.classList.add("is-success")}},githubCommitWorker.postMessage(null);