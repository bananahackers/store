importScripts("wlog.js");const stores=["https://banana-hackers.gitlab.io/store-db/data.json","https://bananahackers.github.io/data.json"];onmessage=function(){wLog("log","Store worker started.");var a={categories:{all:{name:"All apps",icon:"fas fa-store"}},apps:{raw:[],categorical:{}},generatedAt:null};function e(){a.categories={},a.apps.raw=[],a.apps.categorical={}}for(const s of stores){var o=new XMLHttpRequest;if(o.open("GET",s,!1),o.setRequestHeader("Content-Type","application/json"),o.send(),o.status>=200&&o.status<300){wLog("log",'Received successful response from "'+s+'".');try{var t=JSON.parse(o.responseText);if(t.generated_at&&(wLog("log",'Found data "generated_at".'),a.generatedAt=t.generated_at),t.categories){wLog("log",'Found data "categories".');for(const e in t.categories)a.categories[e]=t.categories[e]}if(t.apps){wLog("log",'Found data "apps".'),a.apps.raw=t.apps;for(const e of a.apps.raw)for(const o of e.meta.categories)a.apps.categorical[o]||(a.apps.categorical[o]={}),a.apps.categorical[o][e.name]||(a.apps.categorical[o][e.name]=e);a.apps.categorical.all||(a.apps.categorical.all={});for(const e in a.categories)for(const o in a.apps.categorical[e])a.apps.categorical.all[o]||(a.apps.categorical.all[o]=a.apps.categorical[e][o])}break}catch(a){wLog("error","Error parsing response from store: "+a),e()}}else wLog("error","Error making request to store: "+o.status),e()}wLog("log","Store worker completed!"),postMessage(a)};