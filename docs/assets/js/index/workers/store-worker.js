importScripts("wlog.js");const stores=["https://banana-hackers.gitlab.io/store-db/data.json","https://bananahackers.github.io/data.json"],downloadCounts=["https://bhackers.uber.space/srs/v1/download_counter"];onmessage=function(a){wLog("log","Store worker started.");var e={categories:{all:{name:"All apps",icon:"fas fa-store"}},apps:{raw:[],categorical:{}},downloadCount:{},generatedAt:null};function o(){e.categories={},e.apps.raw=[],e.apps.categorical={}}for(const a of stores){var t=new XMLHttpRequest;if(t.open("GET",a,!1),t.setRequestHeader("Content-Type","application/json"),t.send(),t.status>=200&&t.status<300){wLog("log",'Received successful response from "'+a+'".');try{var s=JSON.parse(t.responseText);if(s.generated_at&&(wLog("log",'Found data "generated_at".'),e.generatedAt=s.generated_at),s.categories){wLog("log",'Found data "categories".');for(const a in s.categories)e.categories[a]=s.categories[a]}if(s.apps){wLog("log",'Found data "apps".'),e.apps.raw=s.apps;for(const a of e.apps.raw)for(const o of a.meta.categories)e.apps.categorical[o]||(e.apps.categorical[o]={}),e.apps.categorical[o][a.name]||(e.apps.categorical[o][a.name]=a);e.apps.categorical.all||(e.apps.categorical.all={});for(const a in e.categories)for(const o in e.apps.categorical[a])e.apps.categorical.all[o]||(e.apps.categorical.all[o]=e.apps.categorical[a][o])}break}catch(a){wLog("error","Error parsing response from store: "+a),o()}}else wLog("error","Error making request to store: "+t.status),o()}wLog("log","Store worker completed!"),postMessage(e)};