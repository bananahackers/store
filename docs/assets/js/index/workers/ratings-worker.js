importScripts("wlog.js"),onmessage=e=>{wLog("log","Ratings worker started.");var s={success:!1,response:{}};switch(e.data.command){case"count":if(wLog("log",'Selected command "count".'),e.data.slug)wLog("log","Making request to download counts tracker."),(a=new XMLHttpRequest).open("GET","https://bhackers.uber.space/srs/v1/download_counter/count/"+e.data.slug,!1),a.timeout=2e3,a.send(),a.status>=200&&a.status<300?(s.success=!0,wLog("log",'Download count for slug "'+e.data.slug+'" recorded successfully.')):wLog("warning",'Download count for slug "'+e.data.slug+'" failed to record (xhr status: '+a.status+").");else wLog("error","Slug not supplied for count command, not performing count!");break;case"login":if(wLog("log",'Selected command "login".'),e.data.args.username&&e.data.args.logintoken)if(wLog("log","Making request to ratings server."),(a=new XMLHttpRequest).open("POST","https://bhackers.uber.space/srs/v1/createuser",!1),a.setRequestHeader("Content-Type","application/json"),a.send(JSON.stringify({username:e.data.username,logintoken:e.data.logintoken})),a.status>=200&&a.status<300)try{s.response=JSON.parse(a.responseText),s.response.success?(s.success=!0,wLog("log","Created user on ratings server successfully!")):wLog("error","Could not create user on ratings server: "+s.response.error)}catch(e){wLog("error","Error parsing response from ratings server: "+e)}else wLog("error","Error making request to ratings server: "+a.status);else wLog("error","Not enough arguments provided for login command, not doing anything!");break;case"add":var a;if(wLog("log",'Selected command "add".'),e.data.args.username&&e.data.args.logintoken&&e.data.args.appid&&e.data.args.points&&e.data.args.description)wLog("log","Making request to ratings server."),(a=new XMLHttpRequest).open("POST","https://bhackers.uber.space/srs/v1/ratings/"+e.data.appid+"/add",!1),a.setRequestHeader("Content-Type","application/json"),a.open(JSON.stringify({username:e.data.args.username,logintoken:e.data.args.logintoken,appid:e.data.args.appid,points:e.data.args.points,description:e.data.args.description}))}wLog("log","Ratings worker completed"),postMessage(s)};